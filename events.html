<!DOCTYPE html>
<html>
<head>
  <title>Event Uploader & Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; }
    input, button { margin: 6px 0; }
    img { margin: 15px 0; border: 1px solid #ddd; border-radius: 8px; }
    #eventDisplay { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 6px; }
    hr { margin: 24px 0; }
  </style>
</head>
<body>
  <h2>Upload New Event</h2>
  <form id="eventForm">
    <input type="text" name="title" placeholder="Title" required><br>
    <input type="text" name="description" placeholder="Description" required><br>
    <input type="text" name="location" placeholder="Location" required><br>
    <input type="datetime-local" name="time" required><br>
    <input type="number" name="capacity" placeholder="Capacity" required><br>
    <input type="number" name="price" placeholder="Price" required><br>
    <input type="number" name="category_id" placeholder="Category ID" required><br>
    <input type="file" name="image" accept="image/*" required><br>
    <button type="submit">Upload Event</button>
  </form>
  <p id="imgPath"></p>

  <hr>

  <button id="getEvent">Get Latest Event</button>
  <div id="eventDisplay"></div>

<script>
document.getElementById('eventForm').onsubmit = async function(e) {
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);

  // POST to backend
  const res = await fetch('http://192.168.18.10:5000/api/events', {
    method: 'POST',
    body: data
  });
  const event = await res.json();

  if (event && event.image_url) {
  alert("✅ Event added successfully!\n\nTitle: " + event.title);
  document.getElementById('imgPath').innerText = 'Image Path: ' + event.image_url;
} else {
  alert("❌ Upload failed! Please try again.");
  document.getElementById('imgPath').innerText = 'Upload failed!';
}

  // Reset form after upload
  form.reset();
};

// Button to GET last event (change endpoint as per your API)
document.getElementById('getEvent').onclick = async function() {
  const res = await fetch('http://localhost:5000/api/events/latest');
  const event = await res.json(); // ✅ response is a single event object

  if (event && event.image_url) {
    document.getElementById('eventDisplay').innerHTML = `
      <img src="http://192.168.18.10:5000${event.image_url}" width="320"><br>
      <b>Title:</b> ${event.title} <br>
      <b>Description:</b> ${event.description} <br>
      <b>Location:</b> ${event.location} <br>
      <b>Time:</b> ${new Date(event.time).toLocaleString()} <br>
      <b>Capacity:</b> ${event.capacity} <br>
      <b>Price:</b> ${event.price} <br>
      <b>Category ID:</b> ${event.category_id}
    `;
  } else {
    document.getElementById('eventDisplay').innerText = 'No event found!';
  }
};

</script>
</body>
</html>
